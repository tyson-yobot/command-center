import { useState } from "react";

export default function ApifyScraperPanel() {
  const [filters, setFilters] = useState({
    platform: "Google Maps",
    category: "",
    location: "",
    radiusMiles: 10,
    ratingMin: 3,
    reviewCountMin: 10,
    paginationLimit: 100,
    delayMs: 1000,
    extractContacts: true,
  });

  function handleChange(e) {
    const { name, value, type, checked } = e.target;
    setFilters({
      ...filters,
      [name]: type === "checkbox" ? checked : type === "number" ? parseInt(value) : value,
    });
  }

  function handleSubmit() {
    fetch("/api/launch-scrape", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        tool: "apify",
        filters,
      }),
    }).then(res => console.log("Apify launched!", res));
  }

  return (
    <div className="bg-gray-900 text-white rounded-xl p-6 shadow-lg space-y-4">
      <h2 className="text-2xl font-semibold">\ud83c\udf10 Apify Filters</h2>

      <div className="grid grid-cols-2 gap-4">
        <select
          name="platform"
          value={filters.platform}
          onChange={handleChange}
          className="p-2 rounded bg-gray-800 w-full"
        >
          <option value="Google Maps">Google Maps</option>
          <option value="Yelp">Yelp</option>
          <option value="Custom">Custom Crawler</option>
        </select>

        <input
          type="text"
          name="category"
          placeholder="\ud83d\udccd Business Category (e.g. Dentists)"
          value={filters.category}
          onChange={handleChange}
          className="p-2 rounded bg-gray-800 w-full"
        />

        <input
          type="text"
          name="location"
          placeholder="\ud83c\udf0d Location (City or Zip)"
          value={filters.location}
          onChange={handleChange}
          className="p-2 rounded bg-gray-800 w-full"
        />

        <input
          type="number"
          name="radiusMiles"
          placeholder="\ud83d\uddfa\ufe0f Radius (miles)"
          value={filters.radiusMiles}
          onChange={handleChange}
          className="p-2 rounded bg-gray-800 w-full"
        />

        <input
          type="number"
          name="ratingMin"
          placeholder="\u2b50\ufe0f Min Rating"
          value={filters.ratingMin}
          onChange={handleChange}
          className="p-2 rounded bg-gray-800 w-full"
          min="1"
          max="5"
        />

        <input
          type="number"
          name="reviewCountMin"
          placeholder="\ud83d\udcac Min Reviews"
          value={filters.reviewCountMin}
          onChange={handleChange}
          className="p-2 rounded bg-gray-800 w-full"
        />

        <input
          type="number"
          name="paginationLimit"
          placeholder="\ud83d\uddd2\ufe0f Max Results"
          value={filters.paginationLimit}
          onChange={handleChange}
          className="p-2 rounded bg-gray-800 w-full"
        />

        <input
          type="number"
          name="delayMs"
          placeholder="\u23f3 Delay per Request (ms)"
          value={filters.delayMs}
          onChange={handleChange}
          className="p-2 rounded bg-gray-800 w-full"
        />
      </div>

      <div className="pt-4">
        <label className="flex items-center gap-2">
          <input
            type="checkbox"
            name="extractContacts"
            checked={filters.extractContacts}
            onChange={handleChange}
          />
          \ud83d\udc64 Extract Contact Info
        </label>
      </div>

      <button
        onClick={handleSubmit}
        className="mt-6 bg-green-600 hover:bg-green-500 text-white font-semibold py-2 px-6 rounded-xl"
      >
        \ud83d\ude80 Launch Apify Scraper
      </button>
    </div>
  );
}
