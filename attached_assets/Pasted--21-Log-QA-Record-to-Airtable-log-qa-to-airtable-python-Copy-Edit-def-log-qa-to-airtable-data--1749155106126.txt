 21. Log QA Record to Airtable â€“ log_qa_to_airtable()
python
Copy
Edit
def log_qa_to_airtable(data):
    record = {
        "fields": {
            "ðŸ“ž Call ID": data["call_id"],
            "ðŸ§ª QA Score": data["qa_score"],
            "ðŸ§  Tags": ", ".join(data["tags"]),
            "ðŸ‘¤ Agent Name": data["agent_name"],
            "ðŸ“„ QA PDF": data["pdf_link"],
            "ðŸ“ Comments": data["qa_comments"],
            "ðŸ•“ Reviewed At": data["timestamp"]
        }
    }
    response = requests.post(
        f"https://api.airtable.com/v0/{AIRTABLE_BASE_ID}/{QA_TABLE_NAME}",
        json=record,
        headers={
            "Authorization": f"Bearer {AIRTABLE_API_KEY}",
            "Content-Type": "application/json"
        }
    )
    return response.status_code == 200
ðŸ§© 22. Parse Call Metadata â€“ parse_call_metadata()
python
Copy
Edit
def parse_call_metadata(raw_json):
    return {
        "call_id": raw_json.get("call_id"),
        "agent_name": raw_json.get("agent", "Unknown"),
        "timestamp": raw_json.get("timestamp", datetime.utcnow().isoformat()),
        "transcript": raw_json.get("transcript", ""),
        "qa_score": raw_json.get("qa_score", 0),
        "qa_comments": raw_json.get("qa_comments", "")
    }
ðŸŽ¯ 23. Score Grading Logic â€“ grade_qa_response()
python
Copy
Edit
def grade_qa_response(transcript):
    score = 0
    if "greet" in transcript.lower():
        score += 2
    if "solution" in transcript.lower():
        score += 3
    if "summary" in transcript.lower():
        score += 2
    if "thank you" in transcript.lower():
        score += 3
    return min(score, 10)
ðŸ§ª 24. Auto QA Trigger â€“ trigger_qa_if_needed()
python
Copy
Edit
def trigger_qa_if_needed(call_data):
    if "escalated" in call_data.get("flags", []):
        run_qa_review_pipeline(call_data)
    elif call_data.get("duration", 0) > 180:
        run_qa_review_pipeline(call_data)
ðŸ”„ 25. Unified QA Orchestrator â€“ qa_orchestrator()
python
Copy
Edit
def qa_orchestrator(raw_json):
    data = parse_call_metadata(raw_json)
    data["qa_score"] = grade_qa_response(data["transcript"])
    data["tags"] = apply_keyword_tags(data["transcript"])
    filename = generate_qa_pdf(data)
    data["pdf_link"] = upload_qa_pdf_to_drive(filename)
    send_qa_slack_alert(data)
    log_qa_to_airtable(data)