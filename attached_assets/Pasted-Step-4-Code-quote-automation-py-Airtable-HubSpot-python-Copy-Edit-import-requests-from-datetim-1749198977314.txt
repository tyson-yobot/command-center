Step 4 Code · quote_automation.py (Airtable + HubSpot)
python
Copy
Edit
import requests
from datetime import datetime

# Airtable config
AIRTABLE_API_KEY = "paty41tSgNrAPUQZV.7c0df078d76ad5bb4ad1f6be2adbf7e0dec16fd9073fbd51f7b64745953bddfa"
AIRTABLE_BASE_ID = "appRt8V3tH4g5Z5if"
CRM_TABLE_ID = "tblNduMZl17CL4VvJ"
SALES_TABLE_ID = "tbl1Rp3OIH8r8sIkC"
ROADMAP_TABLE_ID = "tblbeUZzSBQnQdi7r"
TEMPLATE_TABLE_ID = "tblR33FZs0xF44sZk"

# HubSpot config
HUBSPOT_TOKEN = "YOUR_HUBSPOT_ACCESS_TOKEN"
HUBSPOT_CONTACT_URL = "https://api.hubapi.com/crm/v3/objects/contacts"

# Quote input (example payload)
quote = {
    "company_name": "AMT66",
    "contact_name": "Tyson B.",
    "email": "tyson@yobot.bot",
    "phone": "701-371-8391",
    "quote_number": "Q-20250606-001",
    "quote_date": datetime.now().strftime("%Y-%m-%d"),
    "bot_package": "🤖 Platinum Bot Package",
    "monthly_total": 1999 + 149 + 99,  # example
    "one_time_total": 25000 + 1499 + 999,
    "add_ons": ["📊 SmartSpend™ Dashboard", "🧠 AI Content Studio"],
    "deposit_received": True
}

# Headers
airtable_headers = {
    "Authorization": f"Bearer {AIRTABLE_API_KEY}",
    "Content-Type": "application/json"
}

# 1. Push to CRM Contacts
requests.post(
    f"https://api.airtable.com/v0/{AIRTABLE_BASE_ID}/{CRM_TABLE_ID}",
    headers=airtable_headers,
    json={"fields": {
        "👤 Full Name": quote["contact_name"],
        "📧 Email": quote["email"],
        "🏢 Company Name": quote["company_name"],
        "📞 Phone": quote["phone"],
        "🔢 Quote #": quote["quote_number"],
        "📆 Quote Date": quote["quote_date"]
    }}
)

# 2. Push to Sales Orders
requests.post(
    f"https://api.airtable.com/v0/{AIRTABLE_BASE_ID}/{SALES_TABLE_ID}",
    headers=airtable_headers,
    json={"fields": {
        "🏢 Company Name": quote["company_name"],
        "👤 Contact Name": quote["contact_name"],
        "💬 Selected Add-Ons": ", ".join(quote["add_ons"]),
        "🤖 Bot Package Selected": quote["bot_package"],
        "💳 Monthly Total": quote["monthly_total"],
        "💰 One-Time Total": quote["one_time_total"],
        "🧾 Quote Number": quote["quote_number"],
        "📆 Quote Date": quote["quote_date"],
        "✅ 50% Deposit Received": "✅"
    }}
)

# 3. Push to Roadmap Table from Template
for add_on in [quote["bot_package"]] + quote["add_ons"]:
    # Search for matching tasks
    filter_formula = f"FIND('{add_on}', {{📦 Package or Add-On}})"
    r = requests.get(
        f"https://api.airtable.com/v0/{AIRTABLE_BASE_ID}/{TEMPLATE_TABLE_ID}?filterByFormula={filter_formula}",
        headers=airtable_headers
    )
    for record in r.json().get("records", []):
        task_name = record["fields"]["📌 Task"]
        requests.post(
            f"https://api.airtable.com/v0/{AIRTABLE_BASE_ID}/{ROADMAP_TABLE_ID}",
            headers=airtable_headers,
            json={"fields": {
                "📌 Task": task_name,
                "🏢 Company": quote["company_name"],
                "🧾 Quote Number": quote["quote_number"],
                "👤 Assigned To": "Daniel Sharpe",
                "📥 Source": "Quote Automation"
            }}
        )

# 4. Push to HubSpot
hubspot_headers = {
    "Authorization": f"Bearer {HUBSPOT_TOKEN}",
    "Content-Type": "application/json"
}
requests.post(
    HUBSPOT_CONTACT_URL,
    headers=hubspot_headers,
    json={"properties": {
        "email": quote["email"],
        "firstname": quote["contact_name"].split()[0],
        "lastname": quote["contact_name"].split()[-1],
        "company": quote["company_name"],
        "phone": quote["phone"]
    }}
)