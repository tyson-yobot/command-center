BATCH 13: Airtable Functions to Wire In (91â€“100)
python
Copy
Edit
# âœ… 91. Reset a single test (clear all fields except name)
def reset_test_record(api_key, test_name):
    record = find_airtable_record("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", api_key, "ğŸ§ª Test Name", test_name)
    if not record.get("records"):
        return {"error": "Test not found"}
    fields_to_clear = {
        "âœ… Passed?": "",
        "ğŸ” Retested?": "",
        "ğŸ“… Date Tested": "",
        "ğŸ“… Date Retested": "",
        "ğŸ§  Notes": "",
        "ğŸ¯ QA Score": "",
        "ğŸ§‘â€ğŸ’» Tested By": ""
    }
    return update_airtable_record("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", record["records"][0]["id"], api_key, fields_to_clear)

# âœ… 92. Pull only failed tests with override notes
def get_failed_overridden_tests(api_key):
    records = get_all_airtable_records("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", api_key)
    return [
        r for r in records
        if r["fields"].get("âœ… Passed?") == "No"
        and "MANUAL OVERRIDE" in r["fields"].get("ğŸ§  Notes", "")
    ]

# âœ… 93. Export tests to plain text (basic format)
def export_test_names(api_key):
    records = get_all_airtable_records("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", api_key)
    return "\n".join([r["fields"].get("ğŸ§ª Test Name", "Unnamed") for r in records])

# âœ… 94. Detect duplicate test names
def find_duplicate_tests(api_key):
    records = get_all_airtable_records("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", api_key)
    seen = {}
    duplicates = []
    for r in records:
        name = r["fields"].get("ğŸ§ª Test Name", "")
        if name in seen:
            duplicates.append(name)
        else:
            seen[name] = True
    return list(set(duplicates))

# âœ… 95. Log test runtime duration
def log_test_duration(api_key, test_name, duration_seconds):
    return append_to_test_notes(api_key, test_name, f"â±ï¸ Duration: {duration_seconds} sec")

# âœ… 96. List all tests by status (grouped)
def list_tests_by_status(api_key):
    results = {"Passed": [], "Failed": [], "Blank": []}
    records = get_all_airtable_records("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", api_key)
    for r in records:
        name = r["fields"].get("ğŸ§ª Test Name", "")
        status = r["fields"].get("âœ… Passed?")
        if status == "Yes":
            results["Passed"].append(name)
        elif status == "No":
            results["Failed"].append(name)
        else:
            results["Blank"].append(name)
    return results

# âœ… 97. Bulk assign tester name to all blank tests
def assign_default_tester(api_key, tester_name):
    records = get_all_airtable_records("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", api_key)
    for r in records:
        if not r["fields"].get("ğŸ§‘â€ğŸ’» Tested By"):
            update_airtable_record("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", r["id"], api_key, {
                "ğŸ§‘â€ğŸ’» Tested By": tester_name
            })
    return {"status": "Default tester assigned"}

# âœ… 98. Add batch tag to multiple tests
def batch_tag_tests(api_key, test_names, tag):
    for name in test_names:
        append_to_test_notes(api_key, name, f"ğŸ·ï¸ {tag}")
    return {"status": f"Tagged {len(test_names)} tests"}

# âœ… 99. Get total number of notes logged
def total_notes_logged(api_key):
    records = get_all_airtable_records("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", api_key)
    return sum(1 for r in records if r["fields"].get("ğŸ§  Notes"))

# âœ… 100. Verify that all tests have unique names
def verify_unique_test_names(api_key):
    records = get_all_airtable_records("appCoAtCZdARb4AM2", "tblRNjNnaGL5ICIf9", api_key)
    names = [r["fields"].get("ğŸ§ª Test Name", "") for r in records]
    return len(names) == len(set(names))
